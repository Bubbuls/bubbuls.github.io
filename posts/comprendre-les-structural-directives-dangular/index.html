<!DOCTYPE html>
<html lang="fr-fr" class="wf-firasans-n4-active wf-active">

<head>
	<link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    <meta name="generator" content="Hugo 0.59.0" />
    
    <title>Comprendre les structural directives d&#39;angular &middot; Kevin ALBRECHT</title>
    <meta content="Comprendre les structural directives d&#39;angular - Kevin ALBRECHT" property="og:title">
    <meta content=" - " property="og:description">
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i|Roboto+Mono:300,300i,400,400i" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" href="https://KevinALBRECHT.github.io/css/print.css" media="print">
    <link rel="stylesheet" href="https://KevinALBRECHT.github.io/css/poole.css">
    <link rel="stylesheet" href="https://KevinALBRECHT.github.io/css/hyde.css">
    <!-- Font-Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.10/js/all.js" integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+" crossorigin="anonymous"></script>
    
    <!-- Customised CSS -->
    <link rel="stylesheet" href="https://KevinALBRECHT.github.io/css/custom.css">
        <link rel="stylesheet" href="https://KevinALBRECHT.github.io/css/override.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>

<body>
	<div class="sidebar">
	<div class="container sidebar-sticky">
		<div class="sidebar-about">
			<a href="https://KevinALBRECHT.github.io/">
				<h1 class="brand">Kevin ALBRECHT</h1>
			</a>
			 <img src="/author.jpg" alt="Author Image" class="img-circle headshot center">
			
			<p class="lead">
				<span>
					 Développeur Fullstack 
				</span>
				<span class="lead-second">
					<a href='https://infinitesquare.com/' target="_blank">
						@Infinitesquare
					</a>
				</span>
			</p>
		</div>
		
<div>
	<ul class="sidebar-nav">
		
		
		<li>
			<a href="/"><i class='fa fa-list-ul'></i> <span>Blog Posts</span></a>
		</li>
		<li>
			<a href="/about"><i class='fa fa-user'></i> <span>A Propos</span></a>
		</li>
		</li>
	</ul>
</div>
			<section class="row social text-center">
	<p id="niconico"></p>
	
	<a href="https://twitter.com/kalbrecht_fr"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://github.com/KevinALBRECHT"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	&nbsp;<a href="https://linkedin.com/in/albrechtkevin/"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	&nbsp;<a href="mailto:kevin.albrecht@outlook.fr"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>
	</div>
	<div class="sidebar-sticky sidebar-bottom">
		<p class="copyright">&copy; 2019
			.
			<a href="https://creativecommons.org/licenses/by/4.0">Some Rights Reserved</a>.<br />Built with <a
				href="https://gohugo.io/">Hugo</a> &amp; <a
				href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
		</p>
	</div>
</div>
<script>
	var el = document.getElementById("niconico");
	console.log("el", el);
	var baseUri = "http://nicovideo.cdn.nimg.jp/web/img/base/head/icon/nico/";
	var extension = ".gif";
	var list = ["000","005","007","008","010","011","012","013","014","015","016","018","019","020","022","023","024","026","028","031","032","033","034","035","038","039","040","046","050","052","053","058","061","063","075","078","089","092","094","104","118","127","131","132","135"];
	function getIndex(max) {
		return Math.floor(Math.random() * Math.floor(max));
	}
	var index = getIndex(list.length - 1);
	var content = "<img style='display:inline' src='" + baseUri + list[index] + extension + "' />"
	el.innerHTML = content;
</script>
<img src="">
	<div class="content container">
		<div class="post">
	<h1>Comprendre les structural directives d&#39;angular</h1>
	
	<div class="col-sm-12 col-md-12">
		<span class="text-left post-date meta">
			
			
			<i class="fas fa-calendar-alt"></i> 01/02/2019
			
			
			
			
			
			
			<br />
			 <i class="fas fa-tags"></i>
			
			<a class="meta"
				href="/tags/angular">angular</a> |
			
			
			<a class="meta"
				href="/tags/directive">directive</a> |
			
			
			<a class="meta"
				href="/tags/microsyntaxe">microsyntaxe</a> |
			
			
			<a class="meta"
				href="/tags/ng-template">ng-template</a>
			
			
			
			<br />
			<i class="fas fa-clock"></i> 6 min de lecture
		</span>
	</div>
	
	

<p>J&rsquo;ai beaucoup utilisé les directives structurelles sans avoir pris le temps de me demander comment ça fonctionnait, cependant la &ldquo;mycrosyntaxe&rdquo; d&rsquo;angular paraissait suffisamment puissante pour y faire un détour, initialement je me suis souvent demander ce qui était possible de faire grace aux templates angular, alors voyons comment cela fonctionne.</p>

<h1 id="la-surface-de-l-iceberg">La surface de l&rsquo;iceberg</h1>

<p>Les <a href="https://angular.io/guide/structural-directives">directives structurelles</a> d&rsquo;angular sont les directives qui manipulent les éléments du dom, reconnaissables du fait qu&rsquo;elles commencent toutes par un asterisk, comme par exemple *ngIf et *ngFor.</p>

<p>Pour pouvoir manipuler le dom, ces directives wrap le nœud actuel du dom dans un élément <ng-template>, le nœud conserve tous ses attributs sauf la directive elle-même, qui ne devient plus qu&rsquo;un simple binding sur le template, comme suit :</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">div</span> <span style="color:#960050;background-color:#1e0010">*</span><span style="color:#a6e22e">myDirective</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;randomProperty&#34;</span> &gt; hello &lt;/<span style="color:#f92672">div</span>&gt;

<span style="color:#75715e">&lt;!-- Devient --&gt;</span>

&lt;<span style="color:#f92672">ng-template</span> <span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">myDirective</span><span style="color:#960050;background-color:#1e0010">]=&#34;</span><span style="color:#a6e22e">randomProperty</span><span style="color:#960050;background-color:#1e0010">&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span> &gt; hello &lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">ng-template</span>&gt;</code></pre></td></tr></table>
</div>
</div>

<h1 id="la-microsyntaxe">La microsyntaxe</h1>

<p>L&rsquo;exemple précédent était simple, ici on va  aller plus loins et s&rsquo;intéresser à la microsyntaxe qui est un langage dédié ( ou Domain Language Specific ) et qui permet de créer le template avec tous les bindings nécessaires.
Autrement dit, c&rsquo;est la string donnée à votre directive.</p>

<p>Prenons le cas le plus répandu et clair : la directive *ngFor.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">div</span> <span style="color:#960050;background-color:#1e0010">*</span><span style="color:#a6e22e">ngFor</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;let item of items; let i=index&#34;</span>&gt;
    {{item.title}}
&lt;/<span style="color:#f92672">div</span>&gt;

<span style="color:#75715e">&lt;!-- Devient --&gt;</span>

&lt;<span style="color:#f92672">ng-template</span> <span style="color:#a6e22e">ngFor</span> <span style="color:#a6e22e">let-item</span> <span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">ngForOf</span><span style="color:#960050;background-color:#1e0010">]=&#34;</span><span style="color:#a6e22e">items</span><span style="color:#960050;background-color:#1e0010">&#34;</span> <span style="color:#a6e22e">let-i</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;index&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;{{item.title}}&lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">ng-template</span>&gt;</code></pre></td></tr></table>
</div>
</div>

<p>On peut identifier la microsyntaxe qui est &rdquo;let item of items; let i=index&rdquo; 
Le parser dédié a permit de déterminer 3 elements clef :</p>

<ul>
<li>les mot clef &ldquo;let &rdquo; étaient des attributs.</li>
<li>le mot clef &ldquo;of &rdquo; un binding de type @Input() nommé &ldquo;ngForOf&rdquo;.</li>
<li>notre directive initiale &ldquo;ngFor &rdquo;.</li>
</ul>

<p>une fois les éléments identifiés, ils sont replacé dans le template.</p>

<h2 id="mais-d-ou-ça-sort-tout-ça">Mais d&rsquo;ou ça sort tout ça ?</h2>

<p>Tout d&rsquo;abord le mot clef &ldquo;of &rdquo; est une propriété appartenant à la directive ngFor, la microsyntaxe définit les propriétés comme étant préfixés par le nom de la directive, donc of fait référence à la propriété ngForOf et contrairement aux let-** ici c&rsquo;est un binding type @Input().</p>

<p>En suite &ldquo;let &rdquo; représente un <a href="https://angular.io/guide/template-syntax">template input variable</a> c&rsquo;est à dire une variable à laquelle nous aurons accès, scopé dans le template ( donc aussi à ses enfants ), leurs valeurs viennent de la directive elle-même, mais nous allons voir ça par la suite</p>

<h1 id="contenu-d-une-directive-structurelle">Contenu d&rsquo;une directive structurelle</h1>

<h2 id="création">Création</h2>

<p>Ok, avant de commencer à créer notre directive il faut savoir qu&rsquo;une directive de ce type est composé d&rsquo;un contexte, celui-ci est un objet contenant toutes les propriétés dont nous avons besoin ( les fameux let-i et let-item dans l&rsquo;exemple du *ngFor ) ainsi qu&rsquo;une propriété spéciale &ldquo;$implicit&rdquo; qui représente la référence de tout ce qui n&rsquo;est pas assigné par une valeur dans la microsyntaxe. Avec un schema ça passe mieux ↓</p>

<p>Postulat :</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyDirectiveContext</span>{
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">$implicit</span>: <span style="color:#66d9ef">any</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">event</span>: <span style="color:#66d9ef">any</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
}
</code></pre></td></tr></table>
</div>
</div>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">div</span> <span style="color:#960050;background-color:#1e0010">*</span><span style="color:#a6e22e">ngDirective</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34; &#39;Salut&#39;; let arg; let e=event; from &#39;coucou&#39; &#34;</span>&gt;
    salut
&lt;/<span style="color:#f92672">div</span>&gt;

<span style="color:#75715e">&lt;!-- Devient --&gt;</span>

&lt;<span style="color:#f92672">ng-template</span> <span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">ngDirective</span><span style="color:#960050;background-color:#1e0010">]=&#34;</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">Salut</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#960050;background-color:#1e0010">&#34;</span> <span style="color:#a6e22e">let-arg</span> <span style="color:#a6e22e">let-e</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;event&#34;</span> <span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">ngDirectiveFrom</span><span style="color:#960050;background-color:#1e0010">]=&#34;</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">coucou</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>&gt;
    &lt;<span style="color:#f92672">div</span>&gt;salut&lt;/<span style="color:#f92672">div</span>&gt;
&lt;/<span style="color:#f92672">ng-template</span>&gt;</code></pre></td></tr></table>
</div>
</div>

<p><img src="/microsyntaxe.png" alt="microsyntaxe" /></p>

<p>Maintenant nous allons créer une directive nous même.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Directive</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;

<span style="color:#66d9ef">@Directive</span>({
  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;[appMyDirective]&#39;</span>
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyDirective</span>{

  <span style="color:#66d9ef">constructor</span>() { }

}
</code></pre></td></tr></table>
</div>
</div>

<p>Dans un premier temps il va falloir injecter 2 ressources nécessaires au templating,</p>

<ul>
<li>La référence d&rsquo;un template via la class <a href="https://angular.io/api/core/TemplateRef">TemplateRef<C></a></li>
<li>La référence du conteneur pour éditer les vues, via la class <a href="https://angular.io/api/core/ViewContainerRef">ViewContainerRef</a></li>
</ul>

<p>Puis nous rajoutons une propriété input représentant ce que l&rsquo;on va binder à la directive</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Directive</span>, <span style="color:#a6e22e">TemplateRef</span>, <span style="color:#a6e22e">ViewContainerRef</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;

<span style="color:#66d9ef">@Directive</span>({
  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;[myDirective]&#39;</span>
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyDirective</span>{

   <span style="color:#66d9ef">constructor</span>(
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">templateRef</span>:<span style="color:#66d9ef">TemplateRef</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">any</span><span style="color:#f92672">&gt;</span>,
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">viewContainer</span>:<span style="color:#66d9ef">ViewContainerRef</span>
  ){ }

  <span style="color:#66d9ef">@Input</span>()
  <span style="color:#a6e22e">set</span> <span style="color:#a6e22e">myDirective</span>(<span style="color:#a6e22e">value</span>:<span style="color:#66d9ef">any</span>){
    <span style="color:#75715e">// TODO
</span><span style="color:#75715e"></span>  }
}
</code></pre></td></tr></table>
</div>
</div>

<p>Définissons un contexte</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyDirectiveContext</span> {
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">$implicit</span>: <span style="color:#66d9ef">any</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">count</span>: <span style="color:#66d9ef">any</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
}
</code></pre></td></tr></table>
</div>
</div>

<p>Il ne reste plus qu&rsquo;à créer la vue embarquée</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Directive</span>, <span style="color:#a6e22e">TemplateRef</span>, <span style="color:#a6e22e">ViewContainerRef</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;

<span style="color:#66d9ef">@Directive</span>({
  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;[myDirective]&#39;</span>
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyDirective</span>{
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">_context</span>:<span style="color:#66d9ef">MyDirectiveContext</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">MyDirectiveContext</span>();
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">_myDirective</span>;

   <span style="color:#66d9ef">constructor</span>(
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">templateRef</span>:<span style="color:#66d9ef">TemplateRef</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">any</span><span style="color:#f92672">&gt;</span>,
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">viewContainer</span>:<span style="color:#66d9ef">ViewContainerRef</span>
  ){ }

  <span style="color:#66d9ef">@Input</span>()
  <span style="color:#a6e22e">set</span> <span style="color:#a6e22e">myDirective</span>(<span style="color:#a6e22e">value</span>:<span style="color:#66d9ef">any</span>){
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_myDirective</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>;
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">values</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;.&#39;</span>);
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">length</span>;
  }
}
</code></pre></td></tr></table>
</div>
</div>

<p>Voila, seulement à ce stade , rien ne se passe, car nous disposons bien d&rsquo;une balise <ng-template> mais sans contenu !</p>

<h2 id="manipulation-du-dom">Manipulation du DOM</h2>

<p>Pour créer des vues embedded, il suffit d&rsquo;utiliser le templateRef et le viewContainerRef afin de créer une vues enfant basé sur un template donné.
On va faire quelque chose de semblable à la directive *ngFor, tout à l&rsquo;heure nous avions splité notre chaine de caractères, nous allons créer une vue pour chacune des cases du tableau obtenu.</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">viewContainer</span>.<span style="color:#a6e22e">clear</span>();
    <span style="color:#a6e22e">values</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">message</span>, <span style="color:#a6e22e">index</span>)<span style="color:#f92672">=&gt;</span>{
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">viewContainer</span>.<span style="color:#a6e22e">createEmbeddedView</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">templateRef</span>, {<span style="color:#a6e22e">$implicit</span>:<span style="color:#66d9ef">message</span>, <span style="color:#a6e22e">count</span>:<span style="color:#66d9ef">this._context.count</span>, <span style="color:#a6e22e">index</span>});
    });
</code></pre></td></tr></table>
</div>
</div>

<p>d&rsquo;abord un clear pour vider le container, puis pour chacune des entrées nous créons une vue, en donnant en guise de paramètre , le template initial , et un nouveau contexte.</p>

<p>il ne reste plus qu&rsquo;à appeler la directive dans une vue</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">myDirective</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;initialString; let implicit; let a=count; let i=&#34;</span><span style="color:#a6e22e">index</span><span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">-</span> <span style="color:#a6e22e">$implicit</span> <span style="color:#f92672">=</span> {{<span style="color:#a6e22e">implicit</span>}} <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">amp</span>; <span style="color:#a6e22e">totalCount</span> <span style="color:#f92672">=</span> {{<span style="color:#a6e22e">a</span>}} <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">amp</span>; <span style="color:#a6e22e">currentIndex</span> <span style="color:#f92672">=</span> {{<span style="color:#a6e22e">i</span>}}
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/p&gt;</span>
</code></pre></td></tr></table>
</div>
</div>

<p>Et voila vous savez l&rsquo;essentiel sur les directives structurelles. Maintenant les syntaxes comme ngIf=&ldquo;condition else otherTemplate&rdquo; deviennent clair, tout comme le fait qu&rsquo;angular nous limite à une seule directive structurelle par balise, forcément il serait difficile pour 2 directives de vouloir manipuler le même DOM en simultané. Du coup la derniere question à se poser c&rsquo;est :component ou directive ?</p>

<p>En fait je dirai que les 2 ont un role bien different, on va répondre à une demande de structuration avec les components, qui sont les briques principales de l&rsquo;application et au contraire plutot répondre à un besoin de logique et de dynamisme avec les directives structurelles qui sont plus souples (intéraction facile avec l&rsquo;host ou lels éléments enfants), un exemple simple serait un tableau dynamique qui peut , dans chaque case afficher différent type de donnée : texte brut, input de formulaire, boutton ..etc, le tableau en lui même sera un composant, tandis qu&rsquo;on va jouer sur les template pour fournir le bon format de donnée dans les cases.</p>

<p>Code complet et démo sur le Stackblitz ci-dessous ↓↓</p>

<iframe src="https://stackblitz.com/edit/kal-structural-directive?embed=1&amp;file=src/app/my.directive.ts" width="770" height="800px"></iframe>

<h1 id="bonus">Bonus</h1>

<p>Si vous etes habitué du pipe async d&rsquo;angular vous devez parfois voir ce genre de code</p>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ngIf</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;data$|async as data&#34;</span><span style="color:#f92672">&gt;</span>
    {{<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">title</span>}} 
    {{<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">info</span>}}
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
</code></pre></td></tr></table>
</div>
</div>

<p>Le mot clef &ldquo;as&rdquo; est propre à la microsyntaxe (donc utilisable au sein d&rsquo;un template) et permet d&rsquo;exporter une valeur vers une nouvelle variable. Via une directive vide de logique on va pouvoir réutiliser ce qui est fait ci-dessus sans être obligé d&rsquo;utiliser un ngIf qui va masquer votre template si la condition n&rsquo;est pas remplie. ( voir &ldquo;mySecondDirective&rdquo; sur le stackblitz )</p>

</div>
		<div class="footer">
			



        <h2>Comments</h2>
        <div id="disqus_thread"></div>
<script type="text/javascript">
      (function () {
            
            
            
            if (location.hostname === "localhost" || 
            	location.hostname === "127.0.0.1" || 
            	location.hostname === "") {
                return;
			}
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            var disqus_shortname = 'kalbrecht-blog';
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(
                  dsq);
      })();
</script>

<noscript>
	Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      

		</div>
	</div>
	
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-118690818-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>